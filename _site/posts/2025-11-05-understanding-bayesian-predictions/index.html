<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Stefan Schreiber">
<meta name="dcterms.date" content="2025-11-05">

<title>Understanding Bayesian Predictions ‚Äì Quantitative Environmental Services</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-e83117e711fad372bcb8c8022997a9a8.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">

<script src="../../site_libs/pagedtable-1.1/js/pagedtable.js"></script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Understanding Bayesian Predictions ‚Äì Quantitative Environmental Services">
<meta property="og:description" content="From Complex MCMC Algorithms to Simple Matrix Arithmetic">
<meta property="og:image" content="https://www.envirostats.ca/posts/2025-11-05-understanding-bayesian-predictions/index_files/figure-html/grid-approximation-1.png">
<meta property="og:site_name" content="Quantitative Environmental Services">
<meta property="og:image:height" content="960">
<meta property="og:image:width" content="1344">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/favicon.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Quantitative Environmental Services</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../mission.html"> 
<span class="menu-text">Our Mission</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../services.html"> 
<span class="menu-text">Our Services</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">Who we are</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">Insights</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-core-insight" id="toc-the-core-insight" class="nav-link active" data-scroll-target="#the-core-insight">The Core Insight</a></li>
  <li><a href="#why-is-the-hard-part-hard" id="toc-why-is-the-hard-part-hard" class="nav-link" data-scroll-target="#why-is-the-hard-part-hard">Why is the hard part hard?</a>
  <ul class="collapse">
  <li><a href="#the-goal-a-joint-probability-over-all-parameters" id="toc-the-goal-a-joint-probability-over-all-parameters" class="nav-link" data-scroll-target="#the-goal-a-joint-probability-over-all-parameters">The goal: a joint probability over all parameters</a></li>
  <li><a href="#starting-simple-grid-approximation" id="toc-starting-simple-grid-approximation" class="nav-link" data-scroll-target="#starting-simple-grid-approximation">Starting simple: grid approximation</a></li>
  <li><a href="#the-curse-of-dimensionality-and-continuity" id="toc-the-curse-of-dimensionality-and-continuity" class="nav-link" data-scroll-target="#the-curse-of-dimensionality-and-continuity">The curse of dimensionality (and continuity)</a></li>
  <li><a href="#the-solution-mcmc-explores-the-joint-probability-space" id="toc-the-solution-mcmc-explores-the-joint-probability-space" class="nav-link" data-scroll-target="#the-solution-mcmc-explores-the-joint-probability-space">The solution: MCMC explores the joint probability space</a></li>
  </ul></li>
  <li><a href="#a-simple-example-the-matrix-structure" id="toc-a-simple-example-the-matrix-structure" class="nav-link" data-scroll-target="#a-simple-example-the-matrix-structure">A simple example: the matrix structure</a></li>
  <li><a href="#the-three-level-hierarchy" id="toc-the-three-level-hierarchy" class="nav-link" data-scroll-target="#the-three-level-hierarchy">The three-level hierarchy</a></li>
  <li><a href="#understanding-the-two-kinds-of-predictions" id="toc-understanding-the-two-kinds-of-predictions" class="nav-link" data-scroll-target="#understanding-the-two-kinds-of-predictions">Understanding the two kinds of predictions</a>
  <ul class="collapse">
  <li><a href="#expected-predictions-etildeymid-d" id="toc-expected-predictions-etildeymid-d" class="nav-link" data-scroll-target="#expected-predictions-etildeymid-d">Expected predictions: <span class="math inline">\(E[\tilde{y}\mid D]\)</span></a></li>
  <li><a href="#posterior-predictions-samples-from-ptildeymid-d" id="toc-posterior-predictions-samples-from-ptildeymid-d" class="nav-link" data-scroll-target="#posterior-predictions-samples-from-ptildeymid-d">Posterior predictions: samples from <span class="math inline">\(p(\tilde{y}\mid D)\)</span></a></li>
  <li><a href="#two-types-of-intervals-and-what-they-mean" id="toc-two-types-of-intervals-and-what-they-mean" class="nav-link" data-scroll-target="#two-types-of-intervals-and-what-they-mean">Two types of intervals (and what they mean)</a></li>
  </ul></li>
  <li><a href="#a-complete-example-with-real-tools" id="toc-a-complete-example-with-real-tools" class="nav-link" data-scroll-target="#a-complete-example-with-real-tools">A complete example with real tools</a></li>
  <li><a href="#posterior-predictive-checks-is-your-model-any-good" id="toc-posterior-predictive-checks-is-your-model-any-good" class="nav-link" data-scroll-target="#posterior-predictive-checks-is-your-model-any-good">Posterior predictive checks: Is your model any good?</a>
  <ul class="collapse">
  <li><a href="#when-ppcs-reveal-problems" id="toc-when-ppcs-reveal-problems" class="nav-link" data-scroll-target="#when-ppcs-reveal-problems">When PPCs reveal problems</a></li>
  </ul></li>
  <li><a href="#visualizing-predictions" id="toc-visualizing-predictions" class="nav-link" data-scroll-target="#visualizing-predictions">Visualizing predictions</a>
  <ul class="collapse">
  <li><a href="#what-the-figure-is-showing" id="toc-what-the-figure-is-showing" class="nav-link" data-scroll-target="#what-the-figure-is-showing">What the figure is showing</a></li>
  <li><a href="#comparing-credible-intervals-vs.-prediction-intervals" id="toc-comparing-credible-intervals-vs.-prediction-intervals" class="nav-link" data-scroll-target="#comparing-credible-intervals-vs.-prediction-intervals">Comparing credible intervals vs.&nbsp;prediction intervals</a></li>
  </ul></li>
  <li><a href="#takeaway-from-complex-to-simple" id="toc-takeaway-from-complex-to-simple" class="nav-link" data-scroll-target="#takeaway-from-complex-to-simple">Takeaway: from complex to simple</a></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading">Further reading</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Understanding Bayesian Predictions</h1>
<p class="subtitle lead">From Complex MCMC Algorithms to Simple Matrix Arithmetic</p>
  <div class="quarto-categories">
    <div class="quarto-category">bayesian</div>
    <div class="quarto-category">prediction</div>
    <div class="quarto-category">inference</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Stefan Schreiber </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 5, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>So you‚Äôve just fit your first Bayesian model using <code>brms</code> or <code>rstanarm</code>. Maybe you were surprised by how easy it was ‚Äì the syntax looked almost exactly like <code>lm()</code> for a simple linear regression. You hit run, waited a bit longer than usual, and got‚Ä¶ output. Lots of output.</p>
<p>You look at the summary. There are means and standard deviations, credible intervals, and mysterious diagnostics like ‚ÄúRhat‚Äù and ‚ÄúESS‚Äù. But wait ‚Äì where are the p-values? And how do you actually make predictions? People keep talking about ‚Äúposterior predictions‚Äù and ‚Äúposterior distributions‚Äù ‚Äì what do those actually mean, and how do you work with them?</p>
<p>If you‚Äôve ever felt confused by the terminology around Bayesian predictions ‚Äì posterior predictive distributions, expected predictions, prediction intervals ‚Äì you‚Äôre not alone. But here‚Äôs the secret: once your Bayesian model calculates the posterior distribution, <strong>everything else is just computing means, quantiles, and other summary statistics</strong>. Let me show you what I mean.</p>
<section id="the-core-insight" class="level2">
<h2 class="anchored" data-anchor-id="the-core-insight">The Core Insight</h2>
<p>Bayesian inference has two phases:</p>
<ol type="1">
<li><strong>The hard part</strong>: Computing the posterior distribution <span class="math inline">\(p(\theta\mid D)\)</span> (this is where MCMC).</li>
<li><strong>The easy part</strong>: Summarizing that posterior and quantities derived from it ‚Äì means, standard deviations, quantiles, etc.</li>
</ol>
<p>Once you have posterior samples from <span class="math inline">\(p(\theta\mid D)\)</span>, you can simulate the posterior predictive distribution <span class="math inline">\(p(\tilde{y}\mid D)\)</span> and summarize it with its mean <span class="math inline">\(E[\tilde{y}\mid D]\)</span>. We‚Äôll return to this trio when it becomes most helpful.</p>
</section>
<section id="why-is-the-hard-part-hard" class="level2">
<h2 class="anchored" data-anchor-id="why-is-the-hard-part-hard">Why is the hard part hard?</h2>
<p>Before the ‚Äúeasy part,‚Äù a quick sketch of why computing the posterior is challenging (you don‚Äôt have to master this to <em>use</em> Bayesian methods, but the intuition helps).</p>
<section id="the-goal-a-joint-probability-over-all-parameters" class="level3">
<h3 class="anchored" data-anchor-id="the-goal-a-joint-probability-over-all-parameters">The goal: a joint probability over all parameters</h3>
<p>Bayes‚Äô theorem:</p>
<p><span class="math display">\[
p(\theta \mid D) \;=\; \frac{p(D \mid \theta)\,p(\theta)}{p(D)}
\]</span></p>
<ul>
<li><span class="math inline">\(p(\theta \mid D)\)</span>: <strong>posterior</strong> ‚Äì what we believe about parameters after seeing data<br>
</li>
<li><span class="math inline">\(p(D \mid \theta)\)</span>: <strong>likelihood</strong> ‚Äì how well parameters explain the data<br>
</li>
<li><span class="math inline">\(p(\theta)\)</span>: <strong>prior</strong> ‚Äì what we believed before seeing data<br>
</li>
<li><span class="math inline">\(p(D)\)</span>: <strong>marginal likelihood / evidence</strong> ‚Äì a normalizing constant</li>
</ul>
<p>Because <span class="math inline">\(p(D)\)</span> is often intractable, we work with <span class="math inline">\(p(\theta \mid D) \propto p(D \mid \theta)\, p(\theta)\)</span>. For a simple regression with parameters <span class="math inline">\(\alpha,\beta,\sigma\)</span>:</p>
<p><span class="math display">\[
p(\alpha,\beta,\sigma \mid D) \propto p(D \mid \alpha,\beta,\sigma)\, p(\alpha,\beta,\sigma).
\]</span></p>
<p>This is a joint distribution in a high-dimensional space. More parameters ‚áí higher dimension.</p>
</section>
<section id="starting-simple-grid-approximation" class="level3">
<h3 class="anchored" data-anchor-id="starting-simple-grid-approximation">Starting simple: grid approximation</h3>
<p>Suppose you‚Äôre a fish biologist interested in the hatching rate of rainbow trout. You run an experiment and <strong>4 out of 10 eggs hatched</strong> ‚Äì what‚Äôs the hatching rate <span class="math inline">\(\theta\)</span>? With one parameter, a <strong>grid approximation</strong> shows the mechanics explicitly.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a grid of possible hatching rates from 0 to 1</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>theta_grid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Prior: assume all values equally plausible (flat prior)</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>prior_flat <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">100</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Prior options:</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>prior_flat <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">100</span>)                        <span class="co"># Uninformative</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>prior_conservative <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(theta_grid, <span class="dv">5</span>, <span class="dv">5</span>)    <span class="co"># Moderate rates likely</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>prior_optimistic <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(theta_grid, <span class="dv">8</span>, <span class="dv">2</span>)      <span class="co"># High rates likely</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>prior_skeptical <span class="ot">&lt;-</span> <span class="fu">dbeta</span>(theta_grid, <span class="dv">2</span>, <span class="dv">8</span>)       <span class="co"># Low rates likely</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># üëâ CHANGE THIS LINE to try different priors:</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> prior_flat   </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Likelihood: how likely is observing 4/10 for each possible Œ∏?</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Observed data: 4 hatched out of 10 eggs</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>successes <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>trials <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>observed_rate <span class="ot">&lt;-</span> successes <span class="sc">/</span> trials</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>likelihood <span class="ot">&lt;-</span> <span class="fu">dbinom</span>(successes, <span class="at">size =</span> trials, <span class="at">prob =</span> theta_grid)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Posterior ‚àù Likelihood √ó Prior, then normalize</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">&lt;-</span> likelihood <span class="sc">*</span> prior</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">&lt;-</span> posterior <span class="sc">/</span> <span class="fu">sum</span>(posterior)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the posterior distribution</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">theta =</span> theta_grid, <span class="at">posterior =</span> posterior) <span class="sc">|&gt;</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta, <span class="at">y =</span> posterior)) <span class="sc">+</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Dashed red line = observed rate (from data), stays fixed</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Shows how different priors shift the posterior relative to observed data</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> observed_rate, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Hatching rate (Œ∏)"</span>,</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Posterior probability"</span>,</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Posterior distribution with 100 grid points"</span>) <span class="sc">+</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/grid-approximation-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Quick tie-in:</strong> From this posterior <span class="math inline">\(p(\theta\mid D)\)</span>, we can simulate a posterior predictive distribution <span class="math inline">\(p(\tilde{y}\mid D)\)</span> (e.g., future hatch counts) and summarize it with the expected prediction <span class="math inline">\(E[\tilde{y}\mid D]\)</span>.</p>
</section>
<section id="the-curse-of-dimensionality-and-continuity" class="level3">
<h3 class="anchored" data-anchor-id="the-curse-of-dimensionality-and-continuity">The curse of dimensionality (and continuity)</h3>
<ul>
<li>1 parameter, 100 grid points ‚áí 100 evaluations<br>
</li>
<li>2 parameters ‚áí <span class="math inline">\(100^2 = 10{,}000\)</span><br>
</li>
<li>3 parameters ‚áí <span class="math inline">\(100^3 = 1{,}000{,}000\)</span><br>
</li>
<li>10 parameters ‚áí <span class="math inline">\(100^{10}\)</span> (astronomical)</li>
</ul>
<p>Most parameters are also <strong>continuous</strong>, so inference involves integrals over infinitely many values. For instance, marginalizing <span class="math inline">\(\beta\)</span>:</p>
<p><span class="math display">\[
p(\alpha \mid D) \;=\; \int p(\alpha,\beta \mid D)\,d\beta.
\]</span></p>
<p>Analytical solutions exist for special conjugate cases; real-world models usually require computation.</p>
</section>
<section id="the-solution-mcmc-explores-the-joint-probability-space" class="level3">
<h3 class="anchored" data-anchor-id="the-solution-mcmc-explores-the-joint-probability-space">The solution: MCMC explores the joint probability space</h3>
<p><strong>Markov chain Monte Carlo (MCMC)</strong> avoids gridding and intractable integrals by <em>sampling</em> parameter values, spending more time in high-probability regions of the <strong>joint posterior space</strong>. After convergence and warm-up, the draws are (approximately) samples from the posterior <span class="math inline">\(p(\theta \mid D)\)</span>.</p>
<p>The result is a table of draws (rows = draws, columns = parameters). <strong>That table is the payoff.</strong> From here, we move to predictions via the posterior predictive distribution <span class="math inline">\(p(\tilde{y} \mid D)\)</span> and summaries such as its expectation <span class="math inline">\(E[\tilde{y} \mid D]\)</span>.</p>
</section>
</section>
<section id="a-simple-example-the-matrix-structure" class="level2">
<h2 class="anchored" data-anchor-id="a-simple-example-the-matrix-structure">A simple example: the matrix structure</h2>
<p>Now, how do posterior <strong>parameter</strong> draws become <strong>predictions</strong>? Think in matrices.</p>
<p>Each column corresponds to one posterior draw of <span class="math inline">\((\alpha,\beta,\sigma)\)</span>. For each draw and each observation <span class="math inline">\(i\)</span>, compute the linear predictor <span class="math inline">\(\mu_i = \alpha + \beta x_i\)</span>. Stack those <span class="math inline">\(\mu\)</span> values into a matrix: rows = observations, columns = draws.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># IMPORTANT: This uses only 3 draws for illustration.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Real analyses use 1,000‚Äì4,000+ draws.</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>predicted_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fl">2.0</span>, <span class="fl">2.1</span>, <span class="fl">1.9</span>,  <span class="co"># Obs 1: Œº‚ÇÅ from posterior draws 1, 2, 3</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fl">1.0</span>, <span class="fl">1.2</span>, <span class="fl">1.1</span>,  <span class="co"># Obs 2: Œº‚ÇÇ from posterior draws 1, 2, 3</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fl">4.0</span>, <span class="fl">3.8</span>, <span class="fl">4.2</span>,  <span class="co"># Obs 3: Œº‚ÇÉ from posterior draws 1, 2, 3</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fl">1.0</span>, <span class="fl">1.1</span>, <span class="fl">0.9</span>   <span class="co"># Obs 4: Œº‚ÇÑ from posterior draws 1, 2, 3</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>), <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(predicted_matrix) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Obs 1"</span>, <span class="st">"Obs 2"</span>, <span class="st">"Obs 3"</span>, <span class="st">"Obs 4"</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(predicted_matrix) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Draw 1"</span>, <span class="st">"Draw 2"</span>, <span class="st">"Draw 3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><strong>Why this matters for our trio:</strong><br>
- The columns come from <span class="math inline">\(p(\theta\mid D)\)</span>.<br>
- The matrix of <span class="math inline">\(\mu\)</span> values is the scaffold we use to simulate <span class="math inline">\(p(\tilde{y}\mid D)\)</span>.<br>
- Row summaries of that simulated distribution give <span class="math inline">\(E[\tilde{y}\mid D]\)</span> and intervals.</p>
<p>Let‚Äôs display the matrix with row means (i.e., expected predictions of the mean response for this toy example):</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Prediction Matrix: Each row is an observation, each column is a posterior draw</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Draw 1</th>
<th style="text-align: right;">Draw 2</th>
<th style="text-align: right;">Draw 3</th>
<th style="text-align: right;">Row Mean</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Obs 1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2.1</td>
<td style="text-align: right;">1.9</td>
<td style="text-align: right;">2.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Obs 2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.2</td>
<td style="text-align: right;">1.1</td>
<td style="text-align: right;">1.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Obs 3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3.8</td>
<td style="text-align: right;">4.2</td>
<td style="text-align: right;">4.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Obs 4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.1</td>
<td style="text-align: right;">0.9</td>
<td style="text-align: right;">1.0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Once predictions are organized this way, everything reduces to simple arithmetic across columns:</p>
<ul>
<li><strong>Expected predictions</strong> <span class="math inline">\(E[\tilde{y}\mid D]\)</span>: row means of <span class="math inline">\(\mu_i\)</span></li>
<li><strong>Credible intervals</strong> for the <strong>mean response</strong>: rowwise quantiles of <span class="math inline">\(\mu_i\)</span></li>
<li>Next we‚Äôll add <span class="math inline">\(\sigma\)</span> to generate draws of <span class="math inline">\(\tilde{y}\)</span> ‚áí <span class="math inline">\(p(\tilde{y}\mid D)\)</span> and prediction intervals</li>
</ul>
</section>
<section id="the-three-level-hierarchy" class="level2">
<h2 class="anchored" data-anchor-id="the-three-level-hierarchy">The three-level hierarchy</h2>
<p>To pull our ideas together, here‚Äôs the compact relationship we‚Äôll now use repeatedly:</p>
<pre><code>Parameters Œ∏  ‚Üí  Data y
p(Œ∏|D)        ‚Üí  p(·ªπ|D)      ‚Üí  E[·ªπ|D]
posterior        posterior       mean of the
distribution     predictive       posterior predictive
                 distribution     (expected prediction)</code></pre>
<table class="caption-top table">
<colgroup>
<col style="width: 11%">
<col style="width: 22%">
<col style="width: 30%">
<col style="width: 35%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Level</th>
<th>Distribution</th>
<th>What it describes</th>
<th>Uncertainty captured</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td><span class="math inline">\(p(\theta\mid D)\)</span></td>
<td>What we believe about parameters after seeing data</td>
<td><strong>Parameter</strong> uncertainty</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td><span class="math inline">\(p(\tilde{y}\mid D)\)</span></td>
<td>What we believe about future/unobserved data</td>
<td><strong>Parameter + observation</strong> uncertainty</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td><span class="math inline">\(E[\tilde{y}\mid D]\)</span></td>
<td>Mean of the posterior predictive distribution</td>
<td>Center only (a summary)</td>
</tr>
</tbody>
</table>
<p>Plain language: posterior over parameters ‚áí simulate data from it ‚áí average those simulations.</p>
</section>
<section id="understanding-the-two-kinds-of-predictions" class="level2">
<h2 class="anchored" data-anchor-id="understanding-the-two-kinds-of-predictions">Understanding the two kinds of predictions</h2>
<section id="expected-predictions-etildeymid-d" class="level3">
<h3 class="anchored" data-anchor-id="expected-predictions-etildeymid-d">Expected predictions: <span class="math inline">\(E[\tilde{y}\mid D]\)</span></h3>
<p>For a Normal linear regression with <span class="math inline">\(y_i \sim \text{Normal}(\mu_i,\sigma)\)</span> and <span class="math inline">\(\mu_i = \alpha + \beta x_i\)</span>, <span class="math inline">\(E[y\mid\mu,\sigma] = \mu\)</span>, so <span class="math inline">\(E[\tilde{y}\mid D] = E[\mu\mid D]\)</span>. We can compute this as the mean of the <span class="math inline">\(\mu_i\)</span> across posterior draws.</p>
<p><strong>Why this works:</strong> The Normal distribution is centered at <span class="math inline">\(\mu\)</span>. When we average over many possible future observations (each drawn from <span class="math inline">\(\text{Normal}(\mu, \sigma)\)</span>), we get <span class="math inline">\(\mu\)</span> back ‚Äì the noise <span class="math inline">\(\sigma\)</span> averages out to zero. Then we just average those <span class="math inline">\(\mu\)</span> values across our posterior draws.</p>
<p><strong>When this breaks:</strong> In logistic regression, your linear predictor might average to 0, but <span class="math inline">\(\text{logit}^{-1}(0) = 0.5\)</span> while the average probability could be 0.6. Non-linear transformations don‚Äôt commute with averaging. This is why we simulate full draws from <span class="math inline">\(p(\tilde{y}|D)\)</span> first, then summarize ‚Äì it works for any model.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Expected predictions: mean of Œº·µ¢ across posterior draws</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>epred <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(predicted_matrix)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(epred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Obs 1 Obs 2 Obs 3 Obs 4 
  2.0   1.1   4.0   1.0 </code></pre>
</div>
</div>
</section>
<section id="posterior-predictions-samples-from-ptildeymid-d" class="level3">
<h3 class="anchored" data-anchor-id="posterior-predictions-samples-from-ptildeymid-d">Posterior predictions: samples from <span class="math inline">\(p(\tilde{y}\mid D)\)</span></h3>
<p>To see the full range of plausible observations (not just the mean response), we add observation noise <span class="math inline">\(\sigma\)</span> to the <span class="math inline">\(\mu\)</span> values and simulate <span class="math inline">\(\tilde{y}\)</span>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Posterior draws of œÉ (one for each column)</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>sigma_draws <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.55</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate ·ªπ·µ¢ ~ Normal(Œº·µ¢, œÉ) for each draw</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>y_pred_matrix <span class="ot">&lt;-</span> predicted_matrix</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  y_pred_matrix[, j] <span class="ot">&lt;-</span> predicted_matrix[, j] <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">4</span>, <span class="dv">0</span>, sigma_draws[j])</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Posterior predictions: samples from p(·ªπ|D)</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Draw 1</th>
<th style="text-align: right;">Draw 2</th>
<th style="text-align: right;">Draw 3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Obs 1</td>
<td style="text-align: right;">1.72</td>
<td style="text-align: right;">2.18</td>
<td style="text-align: right;">1.52</td>
</tr>
<tr class="even">
<td style="text-align: left;">Obs 2</td>
<td style="text-align: right;">0.88</td>
<td style="text-align: right;">2.23</td>
<td style="text-align: right;">0.85</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Obs 3</td>
<td style="text-align: right;">4.78</td>
<td style="text-align: right;">4.08</td>
<td style="text-align: right;">4.87</td>
</tr>
<tr class="even">
<td style="text-align: left;">Obs 4</td>
<td style="text-align: right;">1.04</td>
<td style="text-align: right;">0.34</td>
<td style="text-align: right;">1.10</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>These <span class="math inline">\(\tilde{y}\)</span> values vary more than the <span class="math inline">\(\mu\)</span> values because they include <span class="math inline">\(\sigma\)</span>: the <em>irreducible</em> variation around the mean response.</p>
</section>
<section id="two-types-of-intervals-and-what-they-mean" class="level3">
<h3 class="anchored" data-anchor-id="two-types-of-intervals-and-what-they-mean">Two types of intervals (and what they mean)</h3>
<p><strong>Credible intervals (for the mean response)</strong>‚Äìfrom the <span class="math inline">\(\mu_i\)</span> matrix (parameter uncertainty only):</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(predicted_matrix, <span class="dv">1</span>, quantile, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      Obs 1 Obs 2 Obs 3 Obs 4
2.5%  1.905 1.005  3.81 0.905
97.5% 2.095 1.195  4.19 1.095</code></pre>
</div>
</div>
<p><strong>Prediction intervals (for future observations)</strong>‚Äìfrom the <span class="math inline">\(\tilde{y}\)</span> matrix (parameter + observation uncertainty):</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(y_pred_matrix, <span class="dv">1</span>, quantile, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         Obs 1     Obs 2   Obs 3     Obs 4
2.5%  1.532107 0.8563872 4.11169 0.3756778
97.5% 2.154682 2.1618326 4.86855 1.0947654</code></pre>
</div>
</div>
<p>Prediction intervals are always wider: they include both uncertainty about the mean response and the natural spread of outcomes.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Decision guide (tidybayes/R workflow)
</div>
</div>
<div class="callout-body-container callout-body">
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 12%">
<col style="width: 35%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Question</th>
<th>Use</th>
<th>What you get</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>What‚Äôs the average outcome?</td>
<td>Expected predictions</td>
<td><span class="math inline">\(E[\tilde{y}\mid D]\)</span></td>
<td><code>add_epred_draws()</code></td>
</tr>
<tr class="even">
<td>What might I observe?</td>
<td>Posterior predictions</td>
<td>draws from <span class="math inline">\(p(\tilde{y}\mid D)\)</span></td>
<td><code>add_predicted_draws()</code></td>
</tr>
<tr class="odd">
<td>Is my model realistic?</td>
<td>Posterior predictions</td>
<td>compare simulations to data</td>
<td><code>add_predicted_draws()</code></td>
</tr>
<tr class="even">
<td>What‚Äôs the effect of X?</td>
<td>Expected predictions</td>
<td>change in <span class="math inline">\(E[\tilde{y}\mid D]\)</span></td>
<td><code>add_epred_draws()</code></td>
</tr>
<tr class="odd">
<td>Do I need prediction intervals?</td>
<td>Posterior predictions</td>
<td>full uncertainty range</td>
<td><code>add_predicted_draws()</code></td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Mini-recap:</strong> we start with <span class="math inline">\(p(\theta\mid D)\)</span>, simulate <span class="math inline">\(p(\tilde{y}\mid D)\)</span>, and summarize with <span class="math inline">\(E[\tilde{y}\mid D]\)</span>.</p>
</section>
</section>
<section id="a-complete-example-with-real-tools" class="level2">
<h2 class="anchored" data-anchor-id="a-complete-example-with-real-tools">A complete example with real tools</h2>
<p>Let‚Äôs fit a model and produce both kinds of predictions with <code>rstanarm</code> and <code>tidybayes</code>.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstanarm)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate some data: y = 2 + 0.5x + noise</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Bayesian regression (MCMC to get posterior samples)</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">stan_glm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> data,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> <span class="fu">gaussian</span>(),</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">iter =</span> <span class="dv">2000</span>,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">refresh =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="posterior-predictive-checks-is-your-model-any-good" class="level2">
<h2 class="anchored" data-anchor-id="posterior-predictive-checks-is-your-model-any-good">Posterior predictive checks: Is your model any good?</h2>
<p>Before we use our model for predictions, we should check: <strong>does data simulated from our model look like our actual data?</strong> If not, our model is missing something important.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract posterior predictive samples</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>y_rep <span class="ot">&lt;-</span> <span class="fu">posterior_predict</span>(fit)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare distribution of observed vs. simulated data</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ppc_dens_overlay</span>(y, y_rep[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, ]) <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Posterior predictive check: Density comparison"</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Light blue = 100 draws from p(·ªπ|D), Dark blue = observed data"</span>) <span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/ppc-visual-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>What to look for:</strong> Do the light blue curves (simulated data) cover the dark blue curve (observed data)? If observed data looks like ‚Äújust another draw‚Äù from the model, that‚Äôs good. If it‚Äôs systematically different (e.g., observed has heavier tails, bimodality, etc.), your model may need revision.</p>
<p><strong>In our case:</strong> The simulated data (light blue curves) nicely envelope the observed data (dark blue), suggesting our Normal linear model with constant variance is reasonable for this dataset.</p>
<section id="when-ppcs-reveal-problems" class="level3">
<h3 class="anchored" data-anchor-id="when-ppcs-reveal-problems">When PPCs reveal problems</h3>
<p>If posterior predictive checks fail, common issues include:</p>
<ul>
<li><strong>Outliers not captured</strong>: Consider robust likelihoods (Student-t instead of Normal)</li>
<li><strong>Non-constant variance</strong>: Add variance modeling (e.g., <code>sigma ~ x</code>)</li>
<li><strong>Non-linearity missed</strong>: Add polynomial terms or smooths</li>
<li><strong>Clustering ignored</strong>: Consider hierarchical/mixed models</li>
</ul>
</section>
</section>
<section id="visualizing-predictions" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-predictions">Visualizing predictions</h2>
<p>Now that we‚Äôve validated our model, let‚Äôs see both types of predictions in action:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we can extract both types of predictions:</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># - add_epred_draws(): expected predictions E[·ªπ|D]</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># - add_predicted_draws(): full posterior predictive samples p(·ªπ|D)</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's visualize both simultaneously:</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>data <span class="sc">|&gt;</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_epred_draws</span>(fit) <span class="sc">|&gt;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Blue bands: credible intervals for E[Œº|D]</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_lineribbon</span>(<span class="fu">aes</span>(<span class="at">y =</span> .epred), <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.61</span>, <span class="fl">0.89</span>)) <span class="sc">+</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Black points: observed data</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Red points: 50 samples from p(·ªπ|D) showing full predictive distribution</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data <span class="sc">|&gt;</span> <span class="fu">add_predicted_draws</span>(fit) <span class="sc">|&gt;</span> <span class="fu">sample_draws</span>(<span class="dv">50</span>),</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> .prediction),</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.15</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>() <span class="sc">+</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Expected predictions (blue) vs. Posterior predictions (red)"</span>,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Blue bands: E[Œº|D] credible intervals; Red: samples from p(·ªπ|D)"</span>,</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Black = observed data | Blue = credible intervals for mean response | Red = posterior prediction samples"</span>) <span class="sc">+</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/visualize-predictions-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="what-the-figure-is-showing" class="level3">
<h3 class="anchored" data-anchor-id="what-the-figure-is-showing">What the figure is showing</h3>
<ul>
<li><strong>Black points</strong>: observed data<br>
</li>
<li><strong>Blue bands</strong>: credible intervals for the mean response <span class="math inline">\(E[\mu\mid D] = E[\tilde{y}\mid D]\)</span> (for this linear-Gaussian model)<br>
</li>
<li><strong>Red points</strong>: samples from <span class="math inline">\(p(\tilde{y}\mid D)\)</span>‚Äìplausible observations that include <span class="math inline">\(\sigma\)</span></li>
</ul>
<p>Why are the red points more dispersed? They include <span class="math inline">\(\sigma\)</span>, the irreducible variation around the mean response. If you re-ran the same study, new observations would scatter around the blue line much like those red points.</p>
</section>
<section id="comparing-credible-intervals-vs.-prediction-intervals" class="level3">
<h3 class="anchored" data-anchor-id="comparing-credible-intervals-vs.-prediction-intervals">Comparing credible intervals vs.&nbsp;prediction intervals</h3>
<p>The plot above shows both types of uncertainty, but let‚Äôs make the distinction even clearer with a direct comparison:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create new data for prediction</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>newdata <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">50</span>))</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get both types of intervals</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>epred_intervals <span class="ot">&lt;-</span> newdata <span class="sc">|&gt;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_epred_draws</span>(fit) <span class="sc">|&gt;</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(.epred, <span class="at">.width =</span> <span class="fl">0.89</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>pred_intervals <span class="ot">&lt;-</span> newdata <span class="sc">|&gt;</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_predicted_draws</span>(fit) <span class="sc">|&gt;</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(.prediction, <span class="at">.width =</span> <span class="fl">0.89</span>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot credible intervals (for mean response)</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(epred_intervals, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> .epred)) <span class="sc">+</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> .lower, <span class="at">ymax =</span> .upper), <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">fill =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"89% Credible Intervals for E[Œº|D]"</span>,</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Where we expect the mean response to be"</span>,</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">6</span>))</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot prediction intervals (for observations)</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pred_intervals, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> .prediction)) <span class="sc">+</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> .lower, <span class="at">ymax =</span> .upper), <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">fill =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"89% Prediction Intervals for p(·ªπ|D)"</span>,</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Where we expect future observations to fall"</span>,</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">6</span>))</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/interval-comparison-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p><strong>Key insight:</strong> Both plots show the same fitted line, but:</p>
<ul>
<li><p><strong>Left (blue)</strong>: Narrow bands showing uncertainty about the <em>average</em> relationship. ‚ÄúIf I could repeat this experiment infinite times, where would the mean response at each <span class="math inline">\(x\)</span> value fall?‚Äù</p></li>
<li><p><strong>Right (red)</strong>: Wide bands showing uncertainty about <em>individual observations</em>. ‚ÄúIf I collect one new data point at this <span class="math inline">\(x\)</span> value, where will it likely fall?‚Äù</p></li>
</ul>
<p>Notice how the observed data points (black dots) mostly fall within the red bands but often outside the blue bands ‚Äì exactly as they should. The blue bands don‚Äôt try to capture individual observations; they capture the mean trend.</p>
<p><strong>Practical implication:</strong></p>
<ul>
<li>Planning a policy based on expected outcomes? Use credible intervals (blue).</li>
<li>Predicting whether a specific patient will respond? Use prediction intervals (red).</li>
<li>Building a forecast with uncertainty bounds? Use prediction intervals (red).</li>
</ul>
</section>
</section>
<section id="takeaway-from-complex-to-simple" class="level2">
<h2 class="anchored" data-anchor-id="takeaway-from-complex-to-simple">Takeaway: from complex to simple</h2>
<p><strong>Hard part:</strong> compute <span class="math inline">\(p(\theta\mid D)\)</span> with MCMC (explore a high-dimensional space; replace intractable integrals with samples).</p>
<p><strong>Easy part:</strong> treat those samples like columns in a matrix and do arithmetic to move through the trio:</p>
<ul>
<li>Posterior <span class="math inline">\(p(\theta\mid D)\)</span> ‚áí simulate the linear predictor <span class="math inline">\(\mu\)</span> for each draw<br>
</li>
<li>Add noise to get posterior predictive draws <span class="math inline">\(p(\tilde{y}\mid D)\)</span><br>
</li>
<li>Summarize by row means/quantiles to get <span class="math inline">\(E[\tilde{y}\mid D]\)</span>, credible intervals (for means), and prediction intervals (for outcomes)</li>
</ul>
<p>Keep the trio in mind and everything else becomes mechanical.</p>
</section>
<section id="further-reading" class="level2">
<h2 class="anchored" data-anchor-id="further-reading">Further reading</h2>
<ul>
<li>McElreath‚Äôs <a href="https://xcelab.net/rm/statistical-rethinking/">Statistical Rethinking</a> has excellent coverage of posterior prediction and makes these concepts very intuitive</li>
<li>The <a href="https://mjskay.github.io/tidybayes/"><code>tidybayes</code> documentation</a> provides great examples of working with posterior draws in a tidy format</li>
<li>Gelman et al.‚Äôs <em>Bayesian Data Analysis</em> (Chapter 7) covers posterior predictive checking in detail</li>
<li>Kay‚Äôs <a href="https://mjskay.github.io/tidybayes/articles/"><code>tidybayes</code> vignettes</a> show practical workflows for Bayesian analysis in R</li>
</ul>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{schreiber2025,
  author = {Schreiber, Stefan},
  title = {Understanding {Bayesian} {Predictions}},
  date = {2025-11-05},
  url = {https://envirostats.ca/posts/2025-11-05-understanding-bayesian-predictions/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-schreiber2025" class="csl-entry quarto-appendix-citeas" role="listitem">
Schreiber, Stefan. 2025. <span>‚ÄúUnderstanding Bayesian
Predictions.‚Äù</span> November 5, 2025. <a href="https://envirostats.ca/posts/2025-11-05-understanding-bayesian-predictions/">https://envirostats.ca/posts/2025-11-05-understanding-bayesian-predictions/</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/www\.envirostats\.ca");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2025, EnviroStats Solutions Inc.</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>